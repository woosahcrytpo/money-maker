<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Axiom Crypto Runner Board – 1m + Finviz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- TradingView for 1m charts -->
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #f9fafb;
    }
    header {
      padding: 14px 16px;
      border-bottom: 1px solid #111827;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    header h1 {
      margin: 0;
      font-size: 1rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #a5b4fc;
    }
    header small {
      display: block;
      font-size: 0.7rem;
      color: #9ca3af;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.8rem;
      align-items: center;
    }
    .controls label {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    input[type="number"], select {
      background: #020617;
      border: 1px solid #273549;
      border-radius: 6px;
      padding: 5px 8px;
      color: #f9fafb;
      font-size: 0.8rem;
    }
    #finvizPanel {
      border-top: 1px solid #111827;
      border-bottom: 1px solid #111827;
      background: #020617;
    }
    main {
      padding: 14px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }
    .card {
      background: radial-gradient(circle at top left, #111827, #020617);
      border-radius: 14px;
      padding: 12px;
      border: 1px solid #1f2937;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .coin-symbol { font-weight: 600; font-size: 0.95rem; }
    .mode-tag { font-size: 0.7rem; color: #9ca3af; text-align: right; }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 6px 10px;
      font-size: 0.75rem;
      margin: 6px 0;
    }
    .label {
      color: #9ca3af;
      font-size: 0.7rem;
    }
    .value { font-weight: 500; }
    .value.important { font-size: 0.9rem; }
    .risk-good { color: #4ade80; }
    .risk-mid { color: #facc15; }
    .risk-high { color: #fb7185; }
    button {
      background: #111827;
      border-radius: 6px;
      border: 1px solid #374151;
      padding: 4px 8px;
      color: #e5e7eb;
      font-size: 0.7rem;
      cursor: pointer;
    }
    button:hover { background: #1f2937; }
    .footer-note {
      padding: 8px 16px 12px;
      font-size: 0.7rem;
      color: #9ca3af;
      border-top: 1px solid #020617;
    }
    @media (max-width: 600px) {
      main { grid-template-columns: 1fr; } /* single column on phone */
    }
  </style>
</head>
<body>

<header>
  <div>
    <h1>Axiom Runner Board – 1m</h1>
    <small>Top runners • Sol memes • 1m timing • Finviz scanner</small>
  </div>
  <div class="controls">
    <label>
      Account $:
      <input type="number" id="accountSize" value="2000">
    </label>
    <label>
      Mode:
      <select id="modeSelect">
        <option value="runners">Top 10 Runners</option>
        <option value="memes">Sol Memes</option>
      </select>
    </label>
    <button type="button" onclick="openFinviz()">Finviz</button>
    <button type="button" onclick="pickSmallRunner()">Small Runner</button>
  </div>
</header>

<main id="cards"></main>

<div class="footer-note">
  Planning tool only. Uses spot pricing from CoinGecko and 1m charts from TradingView.
  Confirm real perp mark price, leverage, funding, stop and TP inside Axiom before trading.
</div>

<script>
  const memeCoins = [
    { cgId: "dogwifhat", symbol: "WIF" },
    { cgId: "bonk", symbol: "BONK" },
    { cgId: "popcat", symbol: "POPCAT" }
  ];

  // TradingView symbol mapping for common coins
  const tvSymbolMap = {
    "BTC": "BINANCE:BTCUSDT",
    "ETH": "BINANCE:ETHUSDT",
    "SOL": "BINANCE:SOLUSDT",
    "BNB": "BINANCE:BNBUSDT",
    "XRP": "BINANCE:XRPUSDT",
    "DOGE": "BINANCE:DOGEUSDT",
    "LTC": "BINANCE:LTCUSDT",
    "WIF": "BYBIT:WIFUSDT",
    "BONK": "BINANCE:BONKUSDT",
    "POPCAT": "BYBIT:POPCATUSDT"
  };

  function getTvSymbol(sym) {
    const s = sym.toUpperCase();
    return tvSymbolMap[s] || ("BINANCE:" + s + "USDT");
  }

  let lastTrades = [];
  const biasMap = {}; // LONG/SHORT state per coin

  function formatMoney(n){return "$"+n.toFixed(2);}
  function riskClass(p){return p<=1?"risk-good":p<=2?"risk-mid":"risk-high";}

  async function fetchRunners(){
    const r = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=price_change_percentage_24h_desc&per_page=10&page=1");
    if (!r.ok) throw new Error("Failed to fetch runners");
    const d = await r.json();
    return d.map(c=>{
      const e=c.current_price;
      return {
        coin:c.symbol.toUpperCase(),
        entry:e,
        stopLong:e*0.93,
        tp1Long:e*1.1,
        tp2Long:e*1.2,
        stopShort:e*1.07,
        tp1Short:e*0.9,
        tp2Short:e*0.8
      };
    });
  }

  async function fetchMemes(){
    const ids=memeCoins.map(m=>m.cgId).join(",");
    const r=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
    if (!r.ok) throw new Error("Failed to fetch memes");
    const d=await r.json();
    return memeCoins.map(m=>{
      const e=d[m.cgId]?.usd;
      if (!e) return null;
      return {
        coin:m.symbol,
        entry:e,
        stopLong:e*0.93,
        tp1Long:e*1.1,
        tp2Long:e*1.2,
        stopShort:e*1.07,
        tp1Short:e*0.9,
        tp2Short:e*0.8
      };
    }).filter(Boolean);
  }

  function renderCards(trades){
    const acct=+document.getElementById("accountSize").value || 2000;
    const cards=document.getElementById("cards");
    cards.innerHTML="";

    trades.forEach((t,idx)=>{
      const bias = biasMap[t.coin] || "LONG";
      const isShort = bias === "SHORT";

      const entry = t.entry;
      const stop  = isShort ? t.stopShort : t.stopLong;
      const tp1   = isShort ? t.tp1Short : t.tp1Long;
      const tp2   = isShort ? t.tp2Short : t.tp2Long;

      const pos=acct*0.05;
      const lev=5;
      const risk=Math.abs(entry-stop)*pos*lev/entry;
      const rPct=(risk/acct)*100;
      const profitTP1=Math.abs(tp1-entry)*pos*lev/entry;
      const profitTP2=Math.abs(tp2-entry)*pos*lev/entry;

      const chartId = "tv_"+idx;

      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <div class="card-top">
          <div>
            <div class="coin-symbol">${t.coin}</div>
            <div style="font-size:0.8rem;margin-top:2px;">
              <span style="color:${isShort ? '#fb7185' : '#4ade80'};">${bias}</span> · ${lev}x
            </div>
            <div style="margin-top:4px;">
              <button type="button" class="flip-btn" data-coin="${t.coin}">
                Flip ${bias === "LONG" ? "SHORT" : "LONG"}
              </button>
            </div>
          </div>
          <div class="mode-tag">5x scalper</div>
        </div>

        <div id="${chartId}" style="height:160px;width:100%;border-radius:10px;overflow:hidden;margin:6px 0;"></div>

        <div class="grid">
          <div><div class="label">Entry</div><div class="value">${entry.toFixed(6)}</div></div>
          <div><div class="label">Stop</div><div class="value">${stop.toFixed(6)}</div></div>
          <div><div class="label">TP1</div><div class="value">${tp1.toFixed(6)}</div></div>
          <div><div class="label">TP2</div><div class="value">${tp2.toFixed(6)}</div></div>
        </div>

        <div class="grid">
          <div>
            <div class="label">Position</div>
            <div class="value important">${formatMoney(pos)}</div>
          </div>
          <div>
            <div class="label">Risk</div>
            <div class="value important ${riskClass(rPct)}">
              ${formatMoney(risk)} (${rPct.toFixed(1)}% of acct)
            </div>
          </div>
          <div>
            <div class="label">P&L @ TP1</div>
            <div class="value">${formatMoney(profitTP1)}</div>
          </div>
          <div>
            <div class="label">P&L @ TP2</div>
            <div class="value">${formatMoney(profitTP2)}</div>
          </div>
        </div>

        <button class="copy-btn">Copy Trade</button>
        <button class="open-btn">Full Chart</button>
      `;
      cards.appendChild(div);

      // Copy button
      div.querySelector(".copy-btn").addEventListener("click",()=>{
        const txt = `${bias} ${t.coin} ${lev}x | Entry ${entry.toFixed(6)} | Stop ${stop.toFixed(6)} | TP1 ${tp1.toFixed(6)} | TP2 ${tp2.toFixed(6)} | Pos ${formatMoney(pos)} | Risk ~${formatMoney(risk)}`;
        if (navigator.clipboard?.writeText) {
          navigator.clipboard.writeText(txt);
        } else {
          alert(txt);
        }
      });

      // Flip bias button
      div.querySelector(".flip-btn").addEventListener("click",()=>{
        const c = t.coin;
        biasMap[c] = (biasMap[c] === "SHORT") ? "LONG" : "SHORT";
        renderCards(trades);
      });

      // Full chart button
      div.querySelector(".open-btn").addEventListener("click", () => {
        const url = "https://www.tradingview.com/chart/?symbol=" +
          encodeURIComponent(getTvSymbol(t.coin));
        window.open(url, "_blank");
      });

      // TradingView chart
      if (window.TradingView && window.TradingView.widget) {
        new TradingView.widget({
          autosize: true,
          symbol: getTvSymbol(t.coin),
          interval: "1",
          timezone: "Etc/UTC",
          theme: "dark",
          style: "1",
          locale: "en",
          hide_top_toolbar: true,
          hide_legend: true,
          hide_side_toolbar: true,
          container_id: chartId
        });
      }
    });
  }

  async function refresh(fetchNew=true){
    try{
      if(fetchNew){
        const mode=document.getElementById("modeSelect").value;
        lastTrades = mode==="runners" ? await fetchRunners() : await fetchMemes();
      }
      renderCards(lastTrades);
    }catch(e){
      console.error(e);
    }
  }

  function pickSmallRunner() {
    if (!lastTrades.length) return;
    const pick = lastTrades[Math.floor(Math.random() * lastTrades.length)];
    alert("Small Runner Pick: " + pick.coin);
  }

  function openFinviz() {
    window.open("https://finviz.com/crypto.ashx", "_blank");
  }

  document.getElementById("accountSize").addEventListener("input", () => refresh(false));
  document.getElementById("modeSelect").addEventListener("change", () => refresh(true));

  // Initial load + auto refresh
  refresh(true);
  setInterval(()=>refresh(true),30000);
</script>

</body>
</html>
